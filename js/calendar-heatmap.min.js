'use strict';var calendarHeatmap={settings:{gutter:5,item_gutter:1,width:1e3,height:200,item_size:10,label_padding:40,max_block_height:20,transition_duration:500,tooltip_width:250,tooltip_padding:15},init:function(a,b,c,d,e,f){calendarHeatmap.data=a,calendarHeatmap.container=b,calendarHeatmap.color=c||'#ff4500',calendarHeatmap.overview=d||'global',calendarHeatmap.history=['global'],calendarHeatmap.selected={},calendarHeatmap.handler=e,calendarHeatmap.valueType=f||'time',calendarHeatmap.in_transition=!1,calendarHeatmap.createElements(),calendarHeatmap.parseData(),calendarHeatmap.drawChart()},createElements:function(){var a,b,c;if(calendarHeatmap.container!=null){if(a=document.getElementById(calendarHeatmap.container),!a||a.tagName!="DIV")throw'Element not found or not of type div';a.classList.contains('calendar-heatmap')||a.classList.add('calendar-heatmap')}else a=document.createElement('div'),a.className='calendar-heatmap',document.body.appendChild(a);b=d3.select(a).append('svg').attr('class','svg'),calendarHeatmap.items=b.append('g'),calendarHeatmap.labels=b.append('g'),calendarHeatmap.buttons=b.append('g'),calendarHeatmap.tooltip=d3.select(a).append('div').attr('class','heatmap-tooltip').style('opacity',0),c=function(){var c=Math.round((moment()-moment().subtract(1,'year').startOf('week'))/864e5),d=Math.trunc(c/7),e=d+1;calendarHeatmap.settings.width=a.offsetWidth<1e3?1e3:a.offsetWidth,calendarHeatmap.settings.item_size=(calendarHeatmap.settings.width-calendarHeatmap.settings.label_padding)/e-calendarHeatmap.settings.gutter,calendarHeatmap.settings.height=calendarHeatmap.settings.label_padding+7*(calendarHeatmap.settings.item_size+calendarHeatmap.settings.gutter),b.attr('width',calendarHeatmap.settings.width).attr('height',calendarHeatmap.settings.height),!!calendarHeatmap.data&&!!calendarHeatmap.data[0].summary&&calendarHeatmap.drawChart()},c(),window.onresize=function(a){c()}},parseData:function(){if(!calendarHeatmap.data)return;calendarHeatmap.data[0].summary||calendarHeatmap.data.map(function(a){var b=a.details.reduce(function(b,a){return b[a.name]?b[a.name].value+=a.value:b[a.name]={value:a.value},b},{}),c=Object.keys(b).map(function(a){return{name:a,value:b[a].value}});return a.summary=c.sort(function(a,b){return b.value-a.value}),a})},drawChart:function(){calendarHeatmap.overview==='global'?calendarHeatmap.drawGlobalOverview():calendarHeatmap.overview==='year'?calendarHeatmap.drawYearOverview():calendarHeatmap.overview==='month'?calendarHeatmap.drawMonthOverview():calendarHeatmap.overview==='week'?calendarHeatmap.drawWeekOverview():calendarHeatmap.overview==='day'&&calendarHeatmap.drawDayOverview()},drawGlobalOverview:function(){var c,d,e,f,a,b,g;calendarHeatmap.history[calendarHeatmap.history.length-1]!==calendarHeatmap.overview&&calendarHeatmap.history.push(calendarHeatmap.overview),c=moment(calendarHeatmap.data[0].date).startOf('year'),d=moment(calendarHeatmap.data[calendarHeatmap.data.length-1].date).endOf('year'),e=d3.timeYears(c,d).map(function(b){var a=moment(b);return{date:a,total:calendarHeatmap.data.reduce(function(b,c){return moment(c.date).year()===a.year()&&(b+=c.total),b},0),summary:function(){var b=calendarHeatmap.data.reduce(function(d,b){if(moment(b.date).year()===a.year())for(var c=0;c<b.summary.length;c++)d[b.summary[c].name]?d[b.summary[c].name].value+=b.summary[c].value:d[b.summary[c].name]={value:b.summary[c].value};return d},{}),c=Object.keys(b).map(function(a){return{name:a,value:b[a].value}});return c.sort(function(a,b){return b.value-a.value})}()}}),f=d3.max(e,function(a){return a.total}),a=d3.timeYears(c,d).map(function(a){return moment(a)}),b=d3.scaleBand().rangeRound([0,calendarHeatmap.settings.width]).padding([.05]).domain(a.map(function(a){return a.year()})),calendarHeatmap.items.selectAll('.item-block-year').remove(),g=calendarHeatmap.items.selectAll('.item-block-year').data(e).enter().append('rect').attr('class','item item-block-year').attr('width',function(){return(calendarHeatmap.settings.width-calendarHeatmap.settings.label_padding)/a.length-calendarHeatmap.settings.gutter*5}).attr('height',function(){return calendarHeatmap.settings.height-calendarHeatmap.settings.label_padding}).attr('transform',function(a){return'translate('+b(a.date.year())+','+calendarHeatmap.settings.tooltip_padding*2+')'}).attr('fill',function(a){var b=d3.scaleLinear().range(['#ffffff',calendarHeatmap.color||'#ff4500']).domain([-.15*f,f]);return b(a.total)||'#ff4500'}).on('click',function(a){if(calendarHeatmap.in_transition)return;calendarHeatmap.in_transition=!0,calendarHeatmap.selected=a,calendarHeatmap.hideTooltip(),calendarHeatmap.removeGlobalOverview(),calendarHeatmap.overview='year',calendarHeatmap.drawChart()}).style('opacity',0).on('mouseover',function(d){var a,h,e,f,g,c,j,i,k;if(calendarHeatmap.in_transition)return;if(a='',calendarHeatmap.valueType==='time'?(a+='<div><span><strong>Total time tracked:</strong></span>',h=parseInt(d.total,10),e=Math.floor(h/86400),e>0&&(a+='<span>'+(e===1?'1 day':e+' days')+'</span></div>'),f=Math.floor((h-e*86400)/3600),f>0&&(e>0?a+='<div><span></span><span>'+(f===1?'1 hour':f+' hours')+'</span></div>':a+='<span>'+(f===1?'1 hour':f+' hours')+'</span></div>'),g=Math.floor((h-e*86400-f*3600)/60),g>0&&(e>0||f>0?a+='<div><span></span><span>'+(g===1?'1 minute':g+' minutes')+'</span></div>':a+='<span>'+(g===1?'1 minute':g+' minutes')+'</span></div>')):(a+=`<div><span><strong>Total ${calendarHeatmap.valueType}:</strong></span>`,a+=`<span>${d.total}</span></div>`),a+='<br />',d.summary.length<=5)for(c=0;c<d.summary.length;c++)a+='<div><span><strong>'+d.summary[c].name+'</strong></span>',a+='<span>'+calendarHeatmap.formatTime(d.summary[c].value)+'</span></div>';else{for(c=0;c<5;c++)a+='<div><span><strong>'+d.summary[c].name+'</strong></span>',a+='<span>'+calendarHeatmap.formatTime(d.summary[c].value)+'</span></div>';a+='<br />',j=0;for(c=5;c<d.summary.length;c++)j=+d.summary[c].value;a+='<div><span><strong>Other:</strong></span>',a+='<span>'+calendarHeatmap.formatTime(j)+'</span></div>'}for(i=b(d.date.year())+calendarHeatmap.settings.tooltip_padding*2;calendarHeatmap.settings.width-i<calendarHeatmap.settings.tooltip_width+calendarHeatmap.settings.tooltip_padding*5;)i-=10;k=this.getBoundingClientRect().top+calendarHeatmap.settings.tooltip_padding,calendarHeatmap.tooltip.html(a).style('left',i+'px').style('top',k+'px').transition().duration(calendarHeatmap.settings.transition_duration/2).ease(d3.easeLinear).style('opacity',1)}).on('mouseout',function(){if(calendarHeatmap.in_transition)return;calendarHeatmap.hideTooltip()}).transition().delay(function(b,a){return calendarHeatmap.settings.transition_duration*(a+1)/10}).duration(function(){return calendarHeatmap.settings.transition_duration}).ease(d3.easeLinear).style('opacity',1).call(function(a,b){a.empty()&&b();var c=0;a.each(function(){++c}).on('end',function(){--c||b.apply(this,arguments)})},function(){calendarHeatmap.in_transition=!1}),calendarHeatmap.labels.selectAll('.label-year').remove(),calendarHeatmap.labels.selectAll('.label-year').data(a).enter().append('text').attr('class','label label-year').attr('font-size',function(){return Math.floor(calendarHeatmap.settings.label_padding/3)+'px'}).text(function(a){return a.year()}).attr('x',function(a){return b(a.year())}).attr('y',calendarHeatmap.settings.label_padding/2).on('mouseenter',function(a){if(calendarHeatmap.in_transition)return;calendarHeatmap.items.selectAll('.item-block-year').transition().duration(calendarHeatmap.settings.transition_duration).ease(d3.easeLinear).style('opacity',function(b){return moment(b.date).year()===a.year()?1:.1})}).on('mouseout',function(){if(calendarHeatmap.in_transition)return;calendarHeatmap.items.selectAll('.item-block-year').transition().duration(calendarHeatmap.settings.transition_duration).ease(d3.easeLinear).style('opacity',1)}).on('click',function(a){if(calendarHeatmap.in_transition)return;calendarHeatmap.in_transition=!0,calendarHeatmap.selected={date:a},calendarHeatmap.hideTooltip(),calendarHeatmap.removeGlobalOverview(),calendarHeatmap.overview='year',calendarHeatmap.drawChart()})},drawYearOverview:function(){var e,i,g,d,l,b,c,a,j,f,h,k;calendarHeatmap.history[calendarHeatmap.history.length-1]!==calendarHeatmap.overview&&calendarHeatmap.history.push(calendarHeatmap.overview),e=moment(calendarHeatmap.selected.date).startOf('year'),i=moment(calendarHeatmap.selected.date).endOf('year'),g=calendarHeatmap.data.filter(function(a){return e<=moment(a.date)&&moment(a.date)<i}),d=d3.max(g,function(a){return a.total}),l=d3.scaleLinear().range(['#ffffff',calendarHeatmap.color||'#ff4500']).domain([-.15*d,d]),b=function(a){var b=moment(a.date),c=Math.round((b-moment(e).startOf('week'))/864e5),d=Math.trunc(c/7);return d*(calendarHeatmap.settings.item_size+calendarHeatmap.settings.gutter)+calendarHeatmap.settings.label_padding},c=function(a){return calendarHeatmap.settings.label_padding+moment(a.date).weekday()*(calendarHeatmap.settings.item_size+calendarHeatmap.settings.gutter)},a=function(a){return d<=0?calendarHeatmap.settings.item_size:calendarHeatmap.settings.item_size*.75+calendarHeatmap.settings.item_size*a.total/d*.25},calendarHeatmap.items.selectAll('.item-circle').remove(),calendarHeatmap.items.selectAll('.item-circle').data(g).enter().append('rect').attr('class','item item-circle').style('opacity',0).attr('x',function(c){return b(c)+(calendarHeatmap.settings.item_size-a(c))/2}).attr('y',function(b){return c(b)+(calendarHeatmap.settings.item_size-a(b))/2}).attr('rx',function(b){return a(b)}).attr('ry',function(b){return a(b)}).attr('width',function(b){return a(b)}).attr('height',function(b){return a(b)}).attr('fill',function(a){return a.total>0?l(a.total):'transparent'}).on('click',function(a){return;if(calendarHeatmap.in_transition)return;if(a.total===0)return;calendarHeatmap.in_transition=!0,calendarHeatmap.selected=a,calendarHeatmap.hideTooltip(),calendarHeatmap.removeYearOverview(),calendarHeatmap.overview='day',calendarHeatmap.drawChart()}).on('mouseover',function(d){var h,e,f,g,i;if(calendarHeatmap.in_transition)return;h=d3.select(this),function d(){h=h.transition().duration(calendarHeatmap.settings.transition_duration).ease(d3.easeLinear).attr('x',function(a){return b(a)-(calendarHeatmap.settings.item_size*1.1-calendarHeatmap.settings.item_size)/2}).attr('y',function(a){return c(a)-(calendarHeatmap.settings.item_size*1.1-calendarHeatmap.settings.item_size)/2}).attr('width',calendarHeatmap.settings.item_size*1.1).attr('height',calendarHeatmap.settings.item_size*1.1).transition().duration(calendarHeatmap.settings.transition_duration).ease(d3.easeLinear).attr('x',function(c){return b(c)+(calendarHeatmap.settings.item_size-a(c))/2}).attr('y',function(b){return c(b)+(calendarHeatmap.settings.item_size-a(b))/2}).attr('width',function(b){return a(b)}).attr('height',function(b){return a(b)}).on('end',d)}(),e='',calendarHeatmap.valueType==='time'?(e+='<div class="header"><strong>'+(d.total?calendarHeatmap.formatTime(d.total):'No time')+' tracked</strong></div>',e+='<div>on '+moment(d.date).format('dddd, MMM Do YYYY')+'</div><br>'):(e+=`<div class="header"><strong>${d.total} ${calendarHeatmap.valueType}</strong></div>`,e+='<div>on '+moment(d.date).format('dddd, MMM Do YYYY')+'</div><br>');for(f=0;f<d.summary.length;f++)e+='<div><span><strong>'+d.summary[f].name+'</strong></span>',e+='<span>'+calendarHeatmap.formatTime(d.summary[f].value)+'</span></div>';g=b(d)+calendarHeatmap.settings.item_size,calendarHeatmap.settings.width-g<calendarHeatmap.settings.tooltip_width+calendarHeatmap.settings.tooltip_padding*3&&(g-=calendarHeatmap.settings.tooltip_width+calendarHeatmap.settings.tooltip_padding*2),i=this.getBoundingClientRect().top+calendarHeatmap.settings.item_size,calendarHeatmap.tooltip.html(e).style('left',g+'px').style('top',i+'px').transition().duration(calendarHeatmap.settings.transition_duration/2).ease(d3.easeLinear).style('opacity',1)}).on('mouseout',function(){if(calendarHeatmap.in_transition)return;d3.select(this).transition().duration(calendarHeatmap.settings.transition_duration/2).ease(d3.easeLinear).attr('x',function(c){return b(c)+(calendarHeatmap.settings.item_size-a(c))/2}).attr('y',function(b){return c(b)+(calendarHeatmap.settings.item_size-a(b))/2}).attr('width',function(b){return a(b)}).attr('height',function(b){return a(b)}),calendarHeatmap.hideTooltip()}).transition().delay(function(){return(Math.cos(Math.PI*Math.random())+1)*calendarHeatmap.settings.transition_duration}).duration(function(){return calendarHeatmap.settings.transition_duration}).ease(d3.easeLinear).style('opacity',1).call(function(a,b){a.empty()&&b();var c=0;a.each(function(){++c}).on('end',function(){--c||b.apply(this,arguments)})},function(){calendarHeatmap.in_transition=!1}),j=d3.timeMonths(e,i),f=d3.scaleLinear().range([0,calendarHeatmap.settings.width]).domain([0,j.length]),calendarHeatmap.labels.selectAll('.label-month').remove(),calendarHeatmap.labels.selectAll('.label-month').data(j).enter().append('text').attr('class','label label-month').attr('font-size',function(){return Math.floor(calendarHeatmap.settings.label_padding/3)+'px'}).text(function(a){return a.toLocaleDateString('en-us',{month:'short'})}).attr('x',function(b,a){return f(a)+(f(a)-f(a-1))/2}).attr('y',calendarHeatmap.settings.label_padding/2).on('mouseenter',function(a){if(calendarHeatmap.in_transition)return;var b=moment(a);calendarHeatmap.items.selectAll('.item-circle').transition().duration(calendarHeatmap.settings.transition_duration).ease(d3.easeLinear).style('opacity',function(a){return moment(a.date).isSame(b,'month')?1:.1})}).on('mouseout',function(){if(calendarHeatmap.in_transition)return;calendarHeatmap.items.selectAll('.item-circle').transition().duration(calendarHeatmap.settings.transition_duration).ease(d3.easeLinear).style('opacity',1)}).on('click',function(a){if(calendarHeatmap.in_transition)return;var b=calendarHeatmap.data.filter(function(b){return moment(a).startOf('month')<=moment(b.date)&&moment(b.date)<moment(a).endOf('month')});if(!b.length)return;calendarHeatmap.selected={date:a},calendarHeatmap.in_transition=!0,calendarHeatmap.hideTooltip(),calendarHeatmap.removeYearOverview(),calendarHeatmap.overview='month',calendarHeatmap.drawChart()}),h=d3.timeDays(moment().startOf('week'),moment().endOf('week')),k=d3.scaleBand().rangeRound([calendarHeatmap.settings.label_padding,calendarHeatmap.settings.height]).domain(h.map(function(a){return moment(a).weekday()})),calendarHeatmap.labels.selectAll('.label-day').remove(),calendarHeatmap.labels.selectAll('.label-day').data(h).enter().append('text').attr('class','label label-day').attr('x',calendarHeatmap.settings.label_padding/3).attr('y',function(b,a){return k(a)+k.bandwidth()/1.75}).style('text-anchor','left').attr('font-size',function(){return Math.floor(calendarHeatmap.settings.label_padding/3)+'px'}).text(function(a){return moment(a).format('dddd')[0]}).on('mouseenter',function(a){if(calendarHeatmap.in_transition)return;var b=moment(a);calendarHeatmap.items.selectAll('.item-circle').transition().duration(calendarHeatmap.settings.transition_duration).ease(d3.easeLinear).style('opacity',function(a){return moment(a.date).day()===b.day()?1:.1})}).on('mouseout',function(){if(calendarHeatmap.in_transition)return;calendarHeatmap.items.selectAll('.item-circle').transition().duration(calendarHeatmap.settings.transition_duration).ease(d3.easeLinear).style('opacity',1)}),calendarHeatmap.drawButton()},drawMonthOverview:function(){var d,h,f,g,i,a,b,e,j,k,c;for(calendarHeatmap.history[calendarHeatmap.history.length-1]!==calendarHeatmap.overview&&calendarHeatmap.history.push(calendarHeatmap.overview),d=moment(calendarHeatmap.selected.date).startOf('month'),h=moment(calendarHeatmap.selected.date).endOf('month'),f=calendarHeatmap.data.filter(function(a){return d<=moment(a.date)&&moment(a.date)<h}),g=d3.max(f,function(a){return d3.max(a.summary,function(a){return a.value})}),i=d3.timeDays(moment().startOf('week'),moment().endOf('week')),a=d3.scaleBand().rangeRound([calendarHeatmap.settings.label_padding,calendarHeatmap.settings.height]).domain(i.map(function(a){return moment(a).weekday()})),b=[d.clone()];d.week()!==h.week();)b.push(d.add(1,'week').clone());e=d3.scaleBand().rangeRound([calendarHeatmap.settings.label_padding,calendarHeatmap.settings.width]).padding([.05]).domain(b.map(function(a){return a.week()})),calendarHeatmap.items.selectAll('.item-block-month').remove(),j=calendarHeatmap.items.selectAll('.item-block-month').data(f).enter().append('g').attr('class','item item-block-month').attr('width',function(){return(calendarHeatmap.settings.width-calendarHeatmap.settings.label_padding)/b.length-calendarHeatmap.settings.gutter*5}).attr('height',function(){return Math.min(a.bandwidth(),calendarHeatmap.settings.max_block_height)}).attr('transform',function(b){return'translate('+e(moment(b.date).week())+','+(a(moment(b.date).weekday())+a.bandwidth()/1.75-15)+')'}).attr('total',function(a){return a.total}).attr('date',function(a){return a.date}).attr('offset',0).on('click',function(a){if(calendarHeatmap.in_transition)return;if(a.total===0)return;calendarHeatmap.in_transition=!0,calendarHeatmap.selected=a,calendarHeatmap.hideTooltip(),calendarHeatmap.removeMonthOverview(),calendarHeatmap.overview='day',calendarHeatmap.drawChart()}),k=(calendarHeatmap.settings.width-calendarHeatmap.settings.label_padding)/b.length-calendarHeatmap.settings.gutter*5,c=d3.scaleLinear().rangeRound([0,k]),j.selectAll('.item-block-rect').data(function(a){return a.summary}).enter().append('rect').attr('class','item item-block-rect').attr('x',function(b){var d=parseInt(d3.select(this.parentNode).attr('total')),a=parseInt(d3.select(this.parentNode).attr('offset'));return c.domain([0,d]),d3.select(this.parentNode).attr('offset',a+c(b.value)),a}).attr('width',function(a){var b=parseInt(d3.select(this.parentNode).attr('total'));return c.domain([0,b]),Math.max(c(a.value)-calendarHeatmap.settings.item_gutter,1)}).attr('height',function(){return Math.min(a.bandwidth(),calendarHeatmap.settings.max_block_height)}).attr('fill',function(a){var b=d3.scaleLinear().range(['#ffffff',calendarHeatmap.color||'#ff4500']).domain([-.15*g,g]);return b(a.value)||'#ff4500'}).style('opacity',0).on('mouseover',function(c){var d,a,b,f;if(calendarHeatmap.in_transition)return;for(d=new Date(d3.select(this.parentNode).attr('date')),a='',a+='<div class="header"><strong>'+c.name+'</strong></div><br>',a+='<div><strong>'+(c.value?calendarHeatmap.formatTime(c.value):'No time')+' tracked</strong></div>',a+='<div>on '+moment(d).format('dddd, MMM Do YYYY')+'</div>',b=e(moment(d).week())+calendarHeatmap.settings.tooltip_padding;calendarHeatmap.settings.width-b<calendarHeatmap.settings.tooltip_width+calendarHeatmap.settings.tooltip_padding*3;)b-=10;f=this.getBoundingClientRect().top+calendarHeatmap.settings.tooltip_padding,calendarHeatmap.tooltip.html(a).style('left',b+'px').style('top',f+'px').transition().duration(calendarHeatmap.settings.transition_duration/2).ease(d3.easeLinear).style('opacity',1)}).on('mouseout',function(){if(calendarHeatmap.in_transition)return;calendarHeatmap.hideTooltip()}).transition().delay(function(){return(Math.cos(Math.PI*Math.random())+1)*calendarHeatmap.settings.transition_duration}).duration(function(){return calendarHeatmap.settings.transition_duration}).ease(d3.easeLinear).style('opacity',1).call(function(a,b){a.empty()&&b();var c=0;a.each(function(){++c}).on('end',function(){--c||b.apply(this,arguments)})},function(){calendarHeatmap.in_transition=!1}),calendarHeatmap.labels.selectAll('.label-week').remove(),calendarHeatmap.labels.selectAll('.label-week').data(b).enter().append('text').attr('class','label label-week').attr('font-size',function(){return Math.floor(calendarHeatmap.settings.label_padding/3)+'px'}).text(function(a){return'Week '+a.week()}).attr('x',function(a){return e(a.week())}).attr('y',calendarHeatmap.settings.label_padding/2).on('mouseenter',function(a){if(calendarHeatmap.in_transition)return;calendarHeatmap.items.selectAll('.item-block-month').transition().duration(calendarHeatmap.settings.transition_duration).ease(d3.easeLinear).style('opacity',function(b){return moment(b.date).week()===a.week()?1:.1})}).on('mouseout',function(){if(calendarHeatmap.in_transition)return;calendarHeatmap.items.selectAll('.item-block-month').transition().duration(calendarHeatmap.settings.transition_duration).ease(d3.easeLinear).style('opacity',1)}).on('click',function(a){if(calendarHeatmap.in_transition)return;var b=calendarHeatmap.data.filter(function(b){return a.startOf('week')<=moment(b.date)&&moment(b.date)<a.endOf('week')});if(!b.length)return;calendarHeatmap.in_transition=!0,calendarHeatmap.selected={date:a},calendarHeatmap.hideTooltip(),calendarHeatmap.removeMonthOverview(),calendarHeatmap.overview='week',calendarHeatmap.drawChart()}),calendarHeatmap.labels.selectAll('.label-day').remove(),calendarHeatmap.labels.selectAll('.label-day').data(i).enter().append('text').attr('class','label label-day').attr('x',calendarHeatmap.settings.label_padding/3).attr('y',function(c,b){return a(b)+a.bandwidth()/1.75}).style('text-anchor','left').attr('font-size',function(){return Math.floor(calendarHeatmap.settings.label_padding/3)+'px'}).text(function(a){return moment(a).format('dddd')[0]}).on('mouseenter',function(a){if(calendarHeatmap.in_transition)return;var b=moment(a);calendarHeatmap.items.selectAll('.item-block-month').transition().duration(calendarHeatmap.settings.transition_duration).ease(d3.easeLinear).style('opacity',function(a){return moment(a.date).day()===b.day()?1:.1})}).on('mouseout',function(){if(calendarHeatmap.in_transition)return;calendarHeatmap.items.selectAll('.item-block-month').transition().duration(calendarHeatmap.settings.transition_duration).ease(d3.easeLinear).style('opacity',1)}),calendarHeatmap.drawButton()},drawWeekOverview:function(){var g,i,e,f,h,b,c,d,j,k,a;calendarHeatmap.history[calendarHeatmap.history.length-1]!==calendarHeatmap.overview&&calendarHeatmap.history.push(calendarHeatmap.overview),g=moment(calendarHeatmap.selected.date).startOf('week'),i=moment(calendarHeatmap.selected.date).endOf('week'),e=calendarHeatmap.data.filter(function(a){return g<=moment(a.date)&&moment(a.date)<i}),f=d3.max(e,function(a){return d3.max(a.summary,function(a){return a.value})}),h=d3.timeDays(moment().startOf('week'),moment().endOf('week')),b=d3.scaleBand().rangeRound([calendarHeatmap.settings.label_padding,calendarHeatmap.settings.height]).domain(h.map(function(a){return moment(a).weekday()})),c=[g],d=d3.scaleBand().rangeRound([calendarHeatmap.settings.label_padding,calendarHeatmap.settings.width]).padding([.01]).domain(c.map(function(a){return a.week()})),calendarHeatmap.items.selectAll('.item-block-week').remove(),j=calendarHeatmap.items.selectAll('.item-block-week').data(e).enter().append('g').attr('class','item item-block-week').attr('width',function(){return(calendarHeatmap.settings.width-calendarHeatmap.settings.label_padding)/c.length-calendarHeatmap.settings.gutter*5}).attr('height',function(){return Math.min(b.bandwidth(),calendarHeatmap.settings.max_block_height)}).attr('transform',function(a){return'translate('+d(moment(a.date).week())+','+(b(moment(a.date).weekday())+b.bandwidth()/1.75-15)+')'}).attr('total',function(a){return a.total}).attr('date',function(a){return a.date}).attr('offset',0).on('click',function(a){if(calendarHeatmap.in_transition)return;if(a.total===0)return;calendarHeatmap.in_transition=!0,calendarHeatmap.selected=a,calendarHeatmap.hideTooltip(),calendarHeatmap.removeWeekOverview(),calendarHeatmap.overview='day',calendarHeatmap.drawChart()}),k=(calendarHeatmap.settings.width-calendarHeatmap.settings.label_padding)/c.length-calendarHeatmap.settings.gutter*5,a=d3.scaleLinear().rangeRound([0,k]),j.selectAll('.item-block-rect').data(function(a){return a.summary}).enter().append('rect').attr('class','item item-block-rect').attr('x',function(c){var d=parseInt(d3.select(this.parentNode).attr('total')),b=parseInt(d3.select(this.parentNode).attr('offset'));return a.domain([0,d]),d3.select(this.parentNode).attr('offset',b+a(c.value)),b}).attr('width',function(b){var c=parseInt(d3.select(this.parentNode).attr('total'));return a.domain([0,c]),Math.max(a(b.value)-calendarHeatmap.settings.item_gutter,1)}).attr('height',function(){return Math.min(b.bandwidth(),calendarHeatmap.settings.max_block_height)}).attr('fill',function(a){var b=d3.scaleLinear().range(['#ffffff',calendarHeatmap.color||'#ff4500']).domain([-.15*f,f]);return b(a.value)||'#ff4500'}).style('opacity',0).on('mouseover',function(c){var e,b,f,d,g;if(calendarHeatmap.in_transition)return;for(e=new Date(d3.select(this.parentNode).attr('date')),b='',b+='<div class="header"><strong>'+c.name+'</strong></div><br>',b+='<div><strong>'+(c.value?calendarHeatmap.formatTime(c.value):'No time')+' tracked</strong></div>',b+='<div>on '+moment(e).format('dddd, MMM Do YYYY')+'</div>',f=parseInt(d3.select(this.parentNode).attr('total')),a.domain([0,f]),d=parseInt(d3.select(this).attr('x'))+a(c.value)/4+calendarHeatmap.settings.tooltip_width/4;calendarHeatmap.settings.width-d<calendarHeatmap.settings.tooltip_width+calendarHeatmap.settings.tooltip_padding*3;)d-=10;g=this.getBoundingClientRect().top+calendarHeatmap.settings.tooltip_padding,calendarHeatmap.tooltip.html(b).style('left',d+'px').style('top',g+'px').transition().duration(calendarHeatmap.settings.transition_duration/2).ease(d3.easeLinear).style('opacity',1)}).on('mouseout',function(){if(calendarHeatmap.in_transition)return;calendarHeatmap.hideTooltip()}).transition().delay(function(){return(Math.cos(Math.PI*Math.random())+1)*calendarHeatmap.settings.transition_duration}).duration(function(){return calendarHeatmap.settings.transition_duration}).ease(d3.easeLinear).style('opacity',1).call(function(a,b){a.empty()&&b();var c=0;a.each(function(){++c}).on('end',function(){--c||b.apply(this,arguments)})},function(){calendarHeatmap.in_transition=!1}),calendarHeatmap.labels.selectAll('.label-week').remove(),calendarHeatmap.labels.selectAll('.label-week').data(c).enter().append('text').attr('class','label label-week').attr('font-size',function(){return Math.floor(calendarHeatmap.settings.label_padding/3)+'px'}).text(function(a){return'Week '+a.week()}).attr('x',function(a){return d(a.week())}).attr('y',calendarHeatmap.settings.label_padding/2).on('mouseenter',function(a){if(calendarHeatmap.in_transition)return;calendarHeatmap.items.selectAll('.item-block-week').transition().duration(calendarHeatmap.settings.transition_duration).ease(d3.easeLinear).style('opacity',function(b){return moment(b.date).week()===a.week()?1:.1})}).on('mouseout',function(){if(calendarHeatmap.in_transition)return;calendarHeatmap.items.selectAll('.item-block-week').transition().duration(calendarHeatmap.settings.transition_duration).ease(d3.easeLinear).style('opacity',1)}),calendarHeatmap.labels.selectAll('.label-day').remove(),calendarHeatmap.labels.selectAll('.label-day').data(h).enter().append('text').attr('class','label label-day').attr('x',calendarHeatmap.settings.label_padding/3).attr('y',function(c,a){return b(a)+b.bandwidth()/1.75}).style('text-anchor','left').attr('font-size',function(){return Math.floor(calendarHeatmap.settings.label_padding/3)+'px'}).text(function(a){return moment(a).format('dddd')[0]}).on('mouseenter',function(a){if(calendarHeatmap.in_transition)return;var b=moment(a);calendarHeatmap.items.selectAll('.item-block-week').transition().duration(calendarHeatmap.settings.transition_duration).ease(d3.easeLinear).style('opacity',function(a){return moment(a.date).day()===b.day()?1:.1})}).on('mouseout',function(){if(calendarHeatmap.in_transition)return;calendarHeatmap.items.selectAll('.item-block-week').transition().duration(calendarHeatmap.settings.transition_duration).ease(d3.easeLinear).style('opacity',1)}),calendarHeatmap.drawButton()},drawDayOverview:function(){var c,b,a,d,e;calendarHeatmap.history[calendarHeatmap.history.length-1]!==calendarHeatmap.overview&&calendarHeatmap.history.push(calendarHeatmap.overview),Object.keys(calendarHeatmap.selected).length||(calendarHeatmap.selected=calendarHeatmap.data[calendarHeatmap.data.length-1]),c=calendarHeatmap.selected.summary.map(function(a){return a.name}),b=d3.scaleBand().rangeRound([calendarHeatmap.settings.label_padding,calendarHeatmap.settings.height]).domain(c),a=d3.scaleTime().range([calendarHeatmap.settings.label_padding*2,calendarHeatmap.settings.width]).domain([moment(calendarHeatmap.selected.date).startOf('day'),moment(calendarHeatmap.selected.date).endOf('day')]),calendarHeatmap.items.selectAll('.item-block').remove(),calendarHeatmap.items.selectAll('.item-block').data(calendarHeatmap.selected.details).enter().append('rect').attr('class','item item-block').attr('x',function(b){return a(moment(b.date))}).attr('y',function(a){return b(a.name)+b.bandwidth()/2-15}).attr('width',function(b){var c=a(d3.timeSecond.offset(moment(b.date),b.value));return Math.max(c-a(moment(b.date)),1)}).attr('height',function(){return Math.min(b.bandwidth(),calendarHeatmap.settings.max_block_height)}).attr('fill',function(a){return a.color||calendarHeatmap.color||'#ff4500'}).style('opacity',0).on('mouseover',function(b){var c,d,e;if(calendarHeatmap.in_transition)return;for(c='',c+='<div class="header"><strong>'+b.name+'</strong><div><br>',c+='<div><strong>'+(b.value?calendarHeatmap.formatTime(b.value):'No time')+' tracked</strong></div>',c+='<div>on '+moment(b.date).format('dddd, MMM Do YYYY HH:mm')+'</div>',d=b.value*100/(60*60*24)+a(moment(b.date));calendarHeatmap.settings.width-d<calendarHeatmap.settings.tooltip_width+calendarHeatmap.settings.tooltip_padding*3;)d-=10;e=this.getBoundingClientRect().top+calendarHeatmap.settings.tooltip_padding,calendarHeatmap.tooltip.html(c).style('left',d+'px').style('top',e+'px').transition().duration(calendarHeatmap.settings.transition_duration/2).ease(d3.easeLinear).style('opacity',1)}).on('mouseout',function(){if(calendarHeatmap.in_transition)return;calendarHeatmap.hideTooltip()}).on('click',function(a){!!calendarHeatmap.handler&&typeof calendarHeatmap.handler=='function'&&calendarHeatmap.handler(a)}).transition().delay(function(){return(Math.cos(Math.PI*Math.random())+1)*calendarHeatmap.settings.transition_duration}).duration(function(){return calendarHeatmap.settings.transition_duration}).ease(d3.easeLinear).style('opacity',.5).call(function(a,b){a.empty()&&b();var c=0;a.each(function(){++c}).on('end',function(){--c||b.apply(this,arguments)})},function(){calendarHeatmap.in_transition=!1}),d=d3.timeHours(moment(calendarHeatmap.selected.date).startOf('day'),moment(calendarHeatmap.selected.date).endOf('day')),e=d3.scaleTime().range([calendarHeatmap.settings.label_padding*2,calendarHeatmap.settings.width]).domain([0,d.length]),calendarHeatmap.labels.selectAll('.label-time').remove(),calendarHeatmap.labels.selectAll('.label-time').data(d).enter().append('text').attr('class','label label-time').attr('font-size',function(){return Math.floor(calendarHeatmap.settings.label_padding/3)+'px'}).text(function(a){return moment(a).format('HH:mm')}).attr('x',function(b,a){return e(a)}).attr('y',calendarHeatmap.settings.label_padding/2).on('mouseenter',function(c){if(calendarHeatmap.in_transition)return;var b=a(moment(c));calendarHeatmap.items.selectAll('.item-block').transition().duration(calendarHeatmap.settings.transition_duration).ease(d3.easeLinear).style('opacity',function(c){var d=a(moment(c.date)),e=a(moment(c.date).add(c.value,'seconds'));return b>=d&&b<=e?1:.1})}).on('mouseout',function(){if(calendarHeatmap.in_transition)return;calendarHeatmap.items.selectAll('.item-block').transition().duration(calendarHeatmap.settings.transition_duration).ease(d3.easeLinear).style('opacity',.5)}),calendarHeatmap.labels.selectAll('.label-project').remove(),calendarHeatmap.labels.selectAll('.label-project').data(c).enter().append('text').attr('class','label label-project').attr('x',calendarHeatmap.settings.gutter).attr('y',function(a){return b(a)+b.bandwidth()/2}).attr('min-height',function(){return b.bandwidth()}).style('text-anchor','left').attr('font-size',function(){return Math.floor(calendarHeatmap.settings.label_padding/3)+'px'}).text(function(a){return a}).each(function(){for(var a=d3.select(this),c=a.node().getComputedTextLength(),b=a.text();c>calendarHeatmap.settings.label_padding*1.5&&b.length>0;)b=b.slice(0,-1),a.text(b+'...'),c=a.node().getComputedTextLength()}).on('mouseenter',function(a){if(calendarHeatmap.in_transition)return;calendarHeatmap.items.selectAll('.item-block').transition().duration(calendarHeatmap.settings.transition_duration).ease(d3.easeLinear).style('opacity',function(b){return b.name===a?1:.1})}).on('mouseout',function(){if(calendarHeatmap.in_transition)return;calendarHeatmap.items.selectAll('.item-block').transition().duration(calendarHeatmap.settings.transition_duration).ease(d3.easeLinear).style('opacity',.5)}),calendarHeatmap.drawButton()},drawButton:function(){calendarHeatmap.buttons.selectAll('.button').remove();var a=calendarHeatmap.buttons.append('g').attr('class','button button-back').style('opacity',0).on('click',function(){if(calendarHeatmap.in_transition)return;calendarHeatmap.in_transition=!0,calendarHeatmap.overview==='year'?calendarHeatmap.removeYearOverview():calendarHeatmap.overview==='month'?calendarHeatmap.removeMonthOverview():calendarHeatmap.overview==='week'?calendarHeatmap.removeWeekOverview():calendarHeatmap.overview==='day'&&calendarHeatmap.removeDayOverview(),calendarHeatmap.history.pop(),calendarHeatmap.overview=calendarHeatmap.history.pop(),calendarHeatmap.drawChart()});a.append('circle').attr('cx',calendarHeatmap.settings.label_padding/2.25).attr('cy',calendarHeatmap.settings.label_padding/2.5).attr('r',calendarHeatmap.settings.item_size/2),a.append('text').attr('x',calendarHeatmap.settings.label_padding/2.25).attr('y',calendarHeatmap.settings.label_padding/2.5).attr('dy',function(){return Math.floor(calendarHeatmap.settings.width/100)/3}).attr('font-size',function(){return Math.floor(calendarHeatmap.settings.label_padding/3)+'px'}).html('&#x2190;'),a.transition().duration(calendarHeatmap.settings.transition_duration).ease(d3.easeLinear).style('opacity',1)},removeGlobalOverview:function(){calendarHeatmap.items.selectAll('.item-block-year').transition().duration(calendarHeatmap.settings.transition_duration).ease(d3.easeLinear).style('opacity',0).remove(),calendarHeatmap.labels.selectAll('.label-year').remove()},removeYearOverview:function(){calendarHeatmap.items.selectAll('.item-circle').transition().duration(calendarHeatmap.settings.transition_duration).ease(d3.easeLinear).style('opacity',0).remove(),calendarHeatmap.labels.selectAll('.label-day').remove(),calendarHeatmap.labels.selectAll('.label-month').remove(),calendarHeatmap.hideBackButton()},removeMonthOverview:function(){calendarHeatmap.items.selectAll('.item-block-month').selectAll('.item-block-rect').transition().duration(calendarHeatmap.settings.transition_duration).ease(d3.easeLinear).style('opacity',0).attr('x',function(b,a){return a%2===0?-calendarHeatmap.settings.width/3:calendarHeatmap.settings.width/3}).remove(),calendarHeatmap.labels.selectAll('.label-day').remove(),calendarHeatmap.labels.selectAll('.label-week').remove(),calendarHeatmap.hideBackButton()},removeWeekOverview:function(){calendarHeatmap.items.selectAll('.item-block-week').selectAll('.item-block-rect').transition().duration(calendarHeatmap.settings.transition_duration).ease(d3.easeLinear).style('opacity',0).attr('x',function(b,a){return a%2===0?-calendarHeatmap.settings.width/3:calendarHeatmap.settings.width/3}).remove(),calendarHeatmap.labels.selectAll('.label-day').remove(),calendarHeatmap.labels.selectAll('.label-week').remove(),calendarHeatmap.hideBackButton()},removeDayOverview:function(){calendarHeatmap.items.selectAll('.item-block').transition().duration(calendarHeatmap.settings.transition_duration).ease(d3.easeLinear).style('opacity',0).attr('x',function(b,a){return a%2===0?-calendarHeatmap.settings.width/3:calendarHeatmap.settings.width/3}).remove(),calendarHeatmap.labels.selectAll('.label-time').remove(),calendarHeatmap.labels.selectAll('.label-project').remove(),calendarHeatmap.hideBackButton()},hideTooltip:function(){calendarHeatmap.tooltip.transition().duration(calendarHeatmap.settings.transition_duration/2).ease(d3.easeLinear).style('opacity',0)},hideBackButton:function(){calendarHeatmap.buttons.selectAll('.button').transition().duration(calendarHeatmap.settings.transition_duration).ease(d3.easeLinear).style('opacity',0).remove()},formatTime:function(d){var a=Math.floor(d/3600),b=Math.floor((d-a*3600)/60),c='';return a>0&&(c+=a===1?'1 hour ':a+' hours '),b>0&&(c+=b===1?'1 minute':b+' minutes'),a===0&&b===0&&(c=Math.round(d)+' seconds'),c}}